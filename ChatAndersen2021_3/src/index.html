<!DOCTYPE html>
<html lang="En-Eu">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <title>Webpack starter</title>
    <script src="http://localhost:35729/livereload.js"></script>
    <link rel="stylesheet" href="./sass/font-awesome.min.scss">
    <link rel="stylesheet" href="./sass/styles.scss"> 
  </head>
<body>
  <div class="to-display">Login</div>    <!-- добавлено окно логина -->
	  <div class="container clearfix">
		  <div class="people-list" id="people-list">
<!-- Левый хедер  -->			
			<div class = "left-header">
				<img src="images/logoDNA.png" alt="logo" title="Логотип чата">
				<div class="timeonline">
					<span class = "youstatus" title = "время пребывания онлайн"><i class="fa fa-circle online"></i>online <span>1</span> секунд</span>
					<p>
						<span class = "timenow" title = "текущее время">12:21</span>
					</p>
					</div>
					<div class = "come_message">
						<i class="fa fa-comment-o" aria-hidden="true" title="отображение личных сообщений"></i>
						<span class="countMe" title="количество сообщений пользователей" ></span>
					</div>
				<div class = "settings"> 
					<i class="fa fa-cog" aria-hidden="true" title="редактирование персональной информации"></i>
				</div>
		   </div>
<!-- Список пользователей -->	
		   <div class = "onlinemembers" title="отображение общего количества пользователей онлайн">
					<i class="fa fa-circle online"></i>online <span>0</span> участников
		   </div>
			<ul class="list" id="users-list" title="отображение списка участников">
			</ul>
			<div class = "messageinfo">		
			</div>
		</div>
		
		<div class = "right-header" title = "Вкладки переключения между чатами">
			<input type="radio" id="one" name="contorol" checked />
			<label class = "threebuttons" for="one">
				<i class="fa fa-user" aria-hidden="true" title = "Вкладки переключения между чатами"></i>
			</label>
			<input type="radio" id="two" name="contorol" />
			<label class = "threebuttons" for="two">
				<i class="fa fa-users" aria-hidden="true" title = "Вкладки переключения между чатами"></i>
			</label>
			<input type="radio" id="three" name="contorol" />
			<label class = "threebuttons" for="three">
				<i class="fa fa-share-alt" aria-hidden="true" title = "Вкладка выбора чатов"></i>
			</label>
		</div>
<!-- САМ ЧАТ -->		
		
		<div class="chat">    

<!-- ХЕДЕР ВВОДА СООБЩЕНИЙ-->	
			
		  <div class="chat-header clearfix" >
				<img src="images/01.png" alt="avatar">
				<div class="chat-about">
				  <div class="chat-with"></div>
					<div class="chat-num-messages">
            <span>1</span>
            сообщений
          </div>
				</div>
				<i class="fa fa-star"></i>
			</div>
				
<!-- ИСТОРИЯ СООБЩЕНИЙ-->				
				
			<div class="chat-history" title = "отображение сообщений пользователей ">
				<ul id="chat-container">
					<li>
						<div class="message-data">
              <span class="message-data-name"><i class="fa fa-circle online"></i>Test User</span>
              <span class="message-data-time"></span>
						</div>
						<div class="message my-message">
						</div>
					</li>
				</ul>
			</div>
<!-- ТЕКСТОВОЕ ПОЛЕ ВВОДА СООБЩЕНИЙ -->			
			
		<div class="chat-message clearfix">
			<i class="fa fa-align-justify" aria-hidden="true" title = "элемент форматирования текста"></i>&nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-align-center" aria-hidden="true" title = "элемент форматирования текста"></i>&nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-italic" aria-hidden="true" title = "элемент форматирования текста"></i>&nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-bold" aria-hidden="true" title = "элемент форматирования текста"></i>&nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-underline" aria-hidden="true" title = "элемент форматирования текста"></i>&nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-link" aria-hidden="true" title = "элемент форматирования текста"></i><br>
			<br>
			<textarea name="message-to-send" maxlength="500" id="message-to-send" placeholder="Ваше сообщение" rows="3" title = "поле для ввода текста"></textarea>
			<i class="fa fa-paperclip" aria-hidden="true"></i> &nbsp;&nbsp;&nbsp;&nbsp;
			<i class="fa fa-file-image-o"></i>
			<button title = "кнопка отправки сообщений" id="send-message">ОТПРАВИТЬ</button>
		</div>
  </div>
</div>
<!-- добавлено login form -->
<div class="login-modal">
  <h3 class="brand-name">Login(& Register) window</h3>
  <div class="input-field">
    <input type="email" id="username" class="id" placeholder="E-mail address / ID" >
  </div>
  <div class="input-field">
    <input type="password" id="password" class="password" placeholder="Password"></div>
    <button type="submit" class="btn btn-sky" onclick="isClickAuto()">Login</button>
    <br><br>
    <button type="submit" class="btn btn-sky" onclick="isClickReg()" >Register</button> 
  <div class="close-sign">X</div>
</div>
<!-- login form END-->
<script>
  function isClickReg() {
      const userName = document.getElementById('username').value;        
      const password = document.getElementById('password').value;        
      let formData = new FormData(document.forms.form__chat);
      let xhr = new XMLHttpRequest();

      xhr.open("POST", "https://studentschat.herokuapp.com/users/register");
      xhr.setRequestHeader('Content-Type', 'application/json');

      xhr.send(JSON.stringify({ username: userName, password: password}));

      xhr.onload = () => alert(xhr.response);
  }

  function isClickAuto() {

    const userName = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    var dateStartSession = new Date();
    let formData = new FormData(document.forms.form__chat);
    let xhr = new XMLHttpRequest();
    let id_user = '';
    xhr.open("GET", "https://studentschat.herokuapp.com/users");
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.responseType = 'json';

    xhr.onload = () => {
      let flag = false;
      let count = 0;
      if (xhr.status >= 400) {
        alert("status>400")
      } else {
        // alert(xhr.response.length);
        for (let i = 0; i < xhr.response.length; i++) {
            if (xhr.response[i].username == userName && xhr.response[i].password == password) {
                flag = true;
                let date = new Date(Date.now() + 86400e3);
                date = date.toUTCString();
                id_user = xhr.response[i].user_id;
                document.cookie = "id_user=" + id_user + "; expires=" + date;
                document.cookie = "user=" + xhr.response[i].username + "; expires=" + date;
                document.cookie = "date=" + dateStartSession + "; expires=" + date;
                // alert(id_user);
                break;
            } else {
                count++;
            }
        }
        if (flag) {
            document.location.href = "index.html";
        } else {
            alert("Такого пользователя не существует!!!");
        }
    }
}

xhr.onerror = () => alert("Error!");

xhr.send();
}



</script>


</body>
</html>
